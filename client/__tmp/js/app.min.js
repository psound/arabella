/* globals angular */
;(function(angular) {
  //"use strict";

  angular
    .module('distractology', [
      'distractology.common',
      'ngMessages',
      'ui.date',
      'ngResource',
      'ui.router',
      'ui.bootstrap',
      'btford.socket-io',
      'emd.ng-xtorage',
      'ngSanitize',
      'angularTrix',
      'ngCsv',
	  'com.2fdevs.videogular',
	  'com.2fdevs.videogular.plugins.controls',
      'com.2fdevs.videogular.plugins.overlayplay',
      'com.2fdevs.videogular.plugins.poster',
      'com.2fdevs.videogular.plugins.buffering',
      'checklist-model',
      'angular-md5']);

}(window.angular));

/* globals angular */
;(function(angular) {
//    "use strict";

    angular
        .module('distractology')
        .run(function($rootScope) {
            $rootScope.testSubmit = function () {
                alert("You clicked submit.");
            };
        });

}(window.angular));

/* globals angular */
;(function(angular) {
    //"use strict";

    angular
        .module('distractology')
        .config(routeConfig);

    function routeConfig($locationProvider, $urlRouterProvider, $stateProvider) {
        $locationProvider.html5Mode(true);
        $urlRouterProvider.otherwise('/');

        $stateProvider
// the $rootscope.currentState variable is the fastest hack
// I could think of to get the current route name on the body element
// the body is outside of any current view so to get the $state.current.name
// at that level I think we'd have to rewrite the views.
// not doing that at this late date.

            // HOME STATES AND NESTED VIEWS ========================================
            .state('home', {
                url: '/',
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.home.html',
                    },
                    '': {
                        templateUrl: '../views/home.html',
                        controller: 'HomeController',
                        controllerAs: 'home'
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "home";
                }
            })


            // TOUR STATES AND NESTED VIEWS ========================================
            .state('tour', {
                url: '/the-tour',
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/tour/tour.html',
                        controller: 'TourController',
                        controllerAs: 'tour',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "tour";
                }
            })

            // CHALLENGE STATES AND NESTED VIEWS ========================================
            .state('challenge', {
                url: '/the-challenge',
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/challenge.html',
                        controller: 'ChallengeController',
                        controllerAs: 'challenge'
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "challenge";
                }
            })

            // ELEARNING STATES AND NESTED VIEWS ========================================
            .state('elearning', {
                url: '/elearning',
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/elearning/elearning.html',
                        controller: 'ElearningController',
                        controllerAs: 'elearning',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "elearning";
                }
            })

            // nested states
            // url will be nested (/elearning/module-one)
            .state('elearning.module-one', {
                url: '/module-one',
                params: {'hasCode': '', thisCode: '', email: ''},
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/elearning/module.one.html',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "elearning";
                }
            })

            // url will be nested (/elearning/module-two)
            .state('elearning.module-two', {
                url: '/module-two',
                params: {'hasCode': '', thisCode: '', email: ''},
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/elearning/module.two.html',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "elearning";
                }
            })

            // url will be nested (/elearning/module-three)
            .state('elearning.module-three', {
                url: '/module-three',
                params: {'hasCode': '', thisCode: '', email: ''},
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/elearning/module.three.html',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "elearning";
                }
            })

            // url will be nested (/elearning/module-four)
            .state('elearning.module-four', {
                url: '/module-four',
                params: {'hasCode': '', thisCode: '', email: ''},
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/elearning/module.four.html',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "elearning";
                }
            })

            // url will be nested (/elearning/module-five)
            .state('elearning.module-five', {
                url: '/module-five',
                params: {'hasCode': '', thisCode: '', email: ''},
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/elearning/module.five.html',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "elearning";
                }
            })

            // url will be nested (/elearning/module-summary)
            .state('elearning.module-summary', {
                url: '/module-summary',
                params: {'hasCode': '', thisCode: '', email: ''},
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/elearning/module.summary.html',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "elarning";
                }
            })

            // FACTS STATES AND NESTED VIEWS ========================================
            .state('facts', {
                url: '/facts-and-stats',
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/facts.html',
                        controller: 'FactsController',
                        controllerAs: 'facts',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "facts";
                }
            })

            // LAWS STATES AND NESTED VIEWS ========================================
            .state('laws', {
                url: '/laws',
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/laws.html',
                        controller: 'LawsController',
                        controllerAs: 'laws',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "laws";
                }
            })

            // PRESS STATES AND NESTED VIEWS ========================================
            .state('press', {
                url: '/press',
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/press/press.html',
                        controller: 'PressController',
                        controllerAs: 'press',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "press";
                }
            })

            // PRESS.ASSETS STATES AND NESTED VIEWS ========================================
            .state('assets', {
                url: '/photos-videos',
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/press/press.assets.html',
                        controller: 'PressAssetsController',
                        controllerAs: 'assets',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "press";
                }
            })

            // PRESS.MEDIA STATES AND NESTED VIEWS ========================================
            .state('media', {
                url: '/media-coverage',
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/press/press.media.html',
                        controller: 'PressMediaController',
                        controllerAs: 'media',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "press";
                }
            })

            // FAQ STATES AND NESTED VIEWS ========================================
            .state('faq', {
                url: '/faq',
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/faq.html',
                        controller: 'FaqController',
                        controllerAs: 'faq',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "faq";
                }
            })

            // CONTACT STATES AND NESTED VIEWS ========================================
            .state('contact', {
                url: '/contact',
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/contact/contact.html',
                        controller: 'ContactController',
                        controllerAs: 'contact',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "contact";
                }
            })

            // CONTACT.CONFIRMATION STATES AND NESTED VIEWS ========================================
            .state('confirmation', {
                url: '/contact-confirmation',
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/contact/contact.confirmation.html',
                        controller: 'ContactConfirmationController',
                        controllerAs: 'confirmation',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "contact";
                }
            })

            // EDUCATORS STATES AND NESTED VIEWS ========================================
            .state('educators', {
                url: '/educators',
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/educators/educators.html',
                        controller: 'EducatorsController',
                        controllerAs: 'educators',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "educators";
                }
            })

            // EDUCATORS.LANDING STATES AND NESTED VIEWS ========================================
            .state('landing', {
                url: '/educators-landing',
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html',
                    },
                    '': {
                        templateUrl: '../views/educators/educators.landing.html',
                        controller: 'EducatorsLandingController',
                        controllerAs: 'landing',
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "educators";
                }
            })

            // SURVEY STATES AND NESTED VIEWS ========================================
            .state('survey-a', {
                url: '/survey-a',
                views: {
                    '': {
                        templateUrl: '../views/survey/survey.html',
                        controller: 'SurveyController',
                        controllerAs: 'survey',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "survey";
                }
            })

            .state('survey-b', {
                url: '/survey-b',
                views: {
                    '': {
                        templateUrl: '../views/survey/survey-b.html',
                        controller: 'SurveyController',
                        controllerAs: 'survey',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "survey";
                }
            })


            // PRIVACY & TERMS STATES AND NESTED VIEWS ========================================
            .state('privacy', {
                url: '/privacy',
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html'
                    },
                    '': {
                        templateUrl: '../views/privacy.html'
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html'
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "privacy";
                }
            })

            .state('terms', {
                url: '/terms',
                views: {
                    'header@': {
                        templateUrl: '../views/common/header.inner.html'
                    },
                    '': {
                        templateUrl: '../views/terms.html'
                    },
                    'footer@': {
                        templateUrl: '../views/common/footer.html'
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "terms";
                }
            })

            .state('admin', {
                url: '/admin',
                //abstract: true,
                /*data: {
                    requireLogin: true
                },*/
                views: {
                    '': {
                        templateUrl: '../views/admin/home.html',
                        controller: 'AdminHomeController',
                        controllerAs: 'admin'
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "admin";
                }
            })

            .state('admin-data', {
                url: '/admin/data',
                params: { isAuth: '' },
                views: {
                    'header@': {
                        templateUrl: '../views/admin/admin.header.html'
                    },
                    '': {
                        templateUrl: '../views/admin/admin.data.html',
                        controller: 'AdminDataController',
                        controllerAs: 'admin'
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "admin-data";
                }
            })

            .state('admin-tour', {
                url: '/admin/the-tour',
                params: { isAuth: '' },
                views: {
                    'header@': {
                        templateUrl: '../views/admin/admin.header.html'
                    },
                    '': {
                        templateUrl: '../views/tour/tour.admin.html',
                        controller: 'AdmintourController',
                        controllerAs: 'touradmin',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "admin-tour";
                }
            })

            .state('admin-press', {
                url: '/admin/press',
                params: { isAuth: '' },
                views: {
                    'header@': {
                        templateUrl: '../views/admin/admin.header.html'
                    },
                    '': {
                        templateUrl: '../views/press/press.admin.html',
                        controller: 'PressAdminController',
                        controllerAs: 'pressAdmin',
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "admin-press";
                }
            })

            .state('admin-survey', {
                url: '/admin/survey',
                params: { isAuth: '' },
                views: {
                    'header@': {
                        templateUrl: '../views/admin/admin.header.html'
                    },
                    '': {
                        templateUrl: '../views/survey/admin.html',
                        controller: 'AdminController',
                        controllerAs: 'admin'
                    }
                },
                onEnter : function($rootScope){
                    $rootScope.currentState = "admin-survey";
                }
            });

    }

}(window.angular));

;(function(angular) {
  "use strict";

  angular
    .module('distractology')
    .controller('HomeController', ['$log', function($log) {
      var self = this;
      self.title = 'HOME PAGE';
    }]);
}(window.angular));

;(function(angular) {
  //"use strict";

  angular
    .module('distractology')
    .controller('AdminHomeController', ['$log', '$state', '$stateParams', '$http', '$xtorage', '$timeout', 'md5', function($log, $state, $stateParams, $http, $xtorage, $timeout, md5) {
      var self = this;
      self.title = 'ADMINDATA';
      self.loggedIn = false;
      self.loginError = false;

       self.login = function(details) {

          details['password'] = md5.createHash(details.password);
          //$log.log(details);
          $http
                .post('/api/admin/login', details)
                .success(postSuccess)
                .error(postError);
       };

       function postSuccess(data) {
           $log.info('AdminController :: Login :: Success');
           self.rawdata = data;
           self.loggedIn = true;
           $state.go("admin-data", {isAuth: true });
       };

       function postError(data) {
           self.loginError = true;
           $log.info('AdminController :: Login :: Error');
           $log.info('Error: ' + JSON.stringify(data, null, 4));
       };

  }]);
}(window.angular));

;(function(angular) {
  //"use strict";

  angular
    .module('distractology')
    .controller('AdminDataController', ['$log', '$state', '$stateParams', '$http', '$xtorage', '$timeout', function($log, $state, $stateParams, $http, $xtorage, $timeout) {
      var self = this;
      self.title = 'ADMINDATA';
      self.submitted = false;
      self.loggedIn = $stateParams.isAuth;

      var getSuccess = function(data) {
          console.log(data);
          self.rawdata = data;
      };

      if(self.loggedIn == true) {

          var today = new Date();
          self.lastWeek = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000).toDateString();
          self.today = today.toDateString();

          $log.info("Admin Controller");

          $http
              .get('/api/students')
              .success(getSuccess);

      } else {
          $('nav').hide();
      }

  }]);
}(window.angular));

;(function(angular) {
  "use strict";

  angular
    .module('distractology')
    .controller('TourController', ['$log', '$state', '$http', function($log, $state, $http) {
      var self = this;
      self.title = 'THE TOUR';
      self.subtitle = '';

      $http
          .get('/api/tours/getAllActive')
          .success(getSuccess)

    function getSuccess(data) {

      $.each(data, function(i,v){
          self.sameday = false;
          if(v.rangeFrom != v.rangeTo) {
              self.sameday = true;
          }
          var localDateFrom = new Date(v.rangeFrom);
          var localDateTo = new Date(v.rangeTo);
          var localTimeFrom = localDateFrom.getTime();
          var localOffsetFrom = localDateFrom.getTimezoneOffset() * 60000;
          var localTimeTo = localDateTo.getTime();
          var localOffsetTo = localDateTo.getTimezoneOffset() * 60000;
          v.rangeFrom = new Date(localTimeFrom + localOffsetFrom);
          v.rangeTo = new Date(localTimeTo + localOffsetTo);
          v['sameday'] = self.sameday;
      });
      self.activeTours = data;
      $log.log(data);
    };

    }]);
}(window.angular));

;(function(angular) {
 // "use strict";

  angular
    .module('distractology')
    .controller('AdmintourController', ['$log', '$state', '$stateParams', '$http', '$xtorage', '$timeout', function($log, $state, $stateParams, $http, $xtorage, $timeout) {
      var self = this;
      self.title = 'ADMINTOUR';

       self.Date = new Date();

      self.submitted = false;
      self.loggedIn = $stateParams.isAuth;

      function getSuccess(data) {
          self.tours = data;
          $.each(self.tours, function(i,v) {
              v['toDelete'] = false;
              self.sameday = false;
              if(v.rangeFrom != v.rangeTo) {
                  self.sameday = true;
              }
              var localDateFrom = new Date(v.rangeFrom);
              var localDateTo = new Date(v.rangeTo);
              var localTimeFrom = localDateFrom.getTime();
              var localOffsetFrom = localDateFrom.getTimezoneOffset() * 60000;
              var localTimeTo = localDateTo.getTime();
              var localOffsetTo = localDateTo.getTimezoneOffset() * 60000;
              v.rangeFrom = new Date(localTimeFrom + localOffsetFrom);
              v.rangeTo = new Date(localTimeTo + localOffsetTo);
              v['sameday'] = self.sameday;
          });
          self.tours['toDelete'] = true;
      };

        self.submit = function(details) {
            self.newTour = details;
            $http
                .post('/api/tours', details)
                .success(postSuccess)
                .error(postError);

            $log.info('TourController :: Bye!');
            $log.debug(details);
        }

        function postSuccess(data) {
            $log.info('TourController :: Success');
            $log.log(data);
            self.submitted = true;
            self.newTour['isActive'] = true;
            //self.tours.push(self.newTour);
            $('#tourForm')[0].reset();
            $timeout(function() {
                self.submitted = false;
                $state.reload();
            }, 2000);
        }

        function postError(data) {}

        self.deactivateTour = function(v) {
            $log.info('TourUpdateController :: Success');
            //console.log(v);
            $http
                 .post('/api/tours/updateActive', v)
                 .success(deactSuccess)
                 .error(deactError);
        };

        function deactSuccess(data) {};
        function deactError(data) {};

        self.dateOptions = {
            format : 'mm/dd/yyyy',
            minDate: '0'
        };

        self.dateOptions2 = {
            format : 'mm/dd/yyyy',
            minDate : self.rangeTo
        }

        self.erraseTour = function(d) {
            $.each(d, function(i, v){
                if(v.toDelete == true) {
                    v.isActive = false;
                    $http
                      .post('/api/tours/delete', v)
                      .success(deleteSuccess);
                }
            });

        };

        function deleteSuccess(data) {
            console.log(data);
        }
      if(self.loggedIn == true) {


          $log.info('AdminTourController - starting up, yeah!');

          $http
                .get('/api/tours')
                .success(getSuccess);

    } else {
      $('nav').hide();
  }
  }]);

}(window.angular));

;(function(angular) {
    "use strict";

    angular
        .module('distractology')
        .controller('ChallengeController', ['$log', '$state', '$http', function($log, $state, $http) {
            var self = this;
            self.title = 'THE CHALLENGE';
            self.loginError = false;
            $log.info('ChallengeController - starting up, yeah!');

            self.login = function(details) {
                self.thisCode = details.code;
                self.email = details.email;

                if(details.code != 'agent') {
                    $log.info('ChallengeController :: Login');
                    $log.debug(details);

                    $http
                        .post('/api/students/login', details)
                        .success(postSuccess)
                        .error(postError);

                    $log.info('ChallengeController :: Login :: Bye');
                } else {
                    self.hasCode = true;
                    $state.go('elearning.module-one', {hasCode: self.hasCode, thisCode: self.thisCode, email: self.email});
                }
            }

            function postSuccess(data) {
                $log.info('ChallengeController :: Login :: Success');
                $log.log(data);
                self.hasCode = true;
                var beenBefore = {studentCode: self.thisCode}
                $log.debug(beenBefore);

                $http
                    .post('/api/workflows/findAll', beenBefore)
                    .success(whereTogo)

            }

            function postError(data) {
                $log.info('ChallengeController :: Login :: Error');
                $log.error('Error: ' + JSON.stringify(data, null, 4));
                self.loginError = true;
            }

            function whereTogo(data) {
                $log.info('ChallengeController :: FindIt :: Success');
                $log.info(JSON.stringify(data, null, 4));
                if(data.message == null || typeof data.message == 'undefined')
                    $state.go('elearning.module-one', {hasCode: self.hasCode, thisCode: self.thisCode, email: self.email});
                else if(data.message.ModuleId == 1)
                    $state.go('elearning.module-two', {hasCode: self.hasCode, thisCode: self.thisCode, email: self.email});
                else if(data.message.ModuleId == 2)
                    $state.go('elearning.module-three', {hasCode: self.hasCode, thisCode: self.thisCode, email: self.email});
                else if(data.message.ModuleId == 3)
                    $state.go('elearning.module-four', {hasCode: self.hasCode, thisCode: self.thisCode, email: self.email});
                else if(data.message.ModuleId == 4)
                    $state.go('elearning.module-five', {hasCode: self.hasCode, thisCode: self.thisCode, email: self.email});
                else if(data.message.ModuleId == 5)
                    $state.go('elearning.module-summary', {hasCode: self.hasCode, thisCode: self.thisCode, email: self.email});
            }

            self.noCode = function() {
                self.hasCode = false;
                $state.go('elearning.module-one', {hasCode: self.hasCode});
            }

            self.forgotCode = function(recover) {
                console.log('here::' + recover.recoverEmail);

                var cred ={email: recover.recoverEmail};

                $http
                    .post('/api/students/getStudent', cred)
                    .success(sendLostCode);


                    $('#myModal').modal('hide');
            }

            function sendLostCode(data) {
                console.log('send email' + JSON.stringify(data, null, 4));
                var emailData = { email: data.message.email, code: data.message.code, from: 'recover' };
                $http
                    .post('/api/email', emailData);
            }

        }]);

}(window.angular));

;(function(angular) {
    "use strict";

    angular
        .module('distractology')
        .controller('ElearningController', ['$log', '$timeout', 'progressBarService', function($log, $timeout, progressBarService) {
            var self = this;
            self.title = 'ELEARNING'
            
            // initialize progress bar
            //progressBarService.value = 25;
            self.value = 25;
            self.items = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100];
            
            // we will store all of our form data in this object
            self.formData = {};

            // function to process the form
            self.processForm = function() {
                alert('awesome!');
            };
            
            self.testSubmit = function () {
                alert("You clicked submit.");
            };
            
            self.closeAlert = function () {
                self.reason = null;
            };
        }]);
        
}(window.angular));

;(function(angular) {
    "use strict";

    angular
        .module('distractology')
        .controller('ModuleOneController', ['$log', '$state', '$stateParams', 'progressBarService', '$http', '$sce', function($log, $state, $stateParams, progressBarService, $http, $sce) {
            var self = this;
            self.steps = ['one'];
            self.step = 0;

            self.hasCode = $stateParams.hasCode;
            self.thisCode = $stateParams.thisCode;
            self.email = $stateParams.email;

            self.showContinueButton = false;

            $log.debug('Here');

            self.finished = function() {
                self.showContinueButton = true;
            };

            self.config = {
				sources: [
                    {src: $sce.trustAsResourceUrl("http://arbella.media.jackmorton.net/video/2016_Arbella_Module_1.mp4"), type: "video/mp4"},
                    {src: $sce.trustAsResourceUrl("http://arbella.media.jackmorton.net/video/2016_Arbella_Module_1.ogv"), type: "video/ogg"}
				],
                    responsive: true,
				theme: {
                    url:"http://www.videogular.com/styles/themes/default/latest/videogular.css",
                                playIcon: "&#xe000;",
                                pauseIcon: "&#xe001;",
                                volumeLevel3Icon: "&#xe002;",
                                volumeLevel2Icon: "&#xe003;",
                                volumeLevel1Icon: "&#xe004;",
                                volumeLevel0Icon: "&#xe005;",
                                muteIcon: "&#xe006;",
                                enterFullScreenIcon: "&#xe007;",
                                exitFullScreenIcon: "&#xe008;"
                },
				plugins: {
					poster: "http://arbella.media.jackmorton.net/video/posters/2016_Arbella_Module_1_frame1.png",
                    controls: {
                        autoHide: true,
                        autoHideTime: 2000
                    }
				}
			};


            self.isFirstStep = function () {
                return self.step === 0;
            };

            self.isLastStep = function () {
                return self.step === (self.steps.length - 1);
            };

            self.isCurrentStep = function (step) {
                return self.step === step;
            };

            self.setCurrentStep = function (step) {
                self.step = step;
            };

            self.getCurrentStep = function () {
                return self.steps[self.step];
            };

            self.getNextLabel = function () {
                return (self.isLastStep()) ? 'Continue' : 'Continue';
            };

            self.handlePrevious = function () {
                self.step -= (self.isFirstStep()) ? 0 : 1;
            };

            self.handleNext = function () {
                if (self.isLastStep()) {
                    var moduleDetails = {studentCode: self.thisCode, module: 1 };

                    if(self.hasCode == true && self.thisCode != 'agent') {
                    $http
                        .post('/api/workflows', moduleDetails)

                        $log.info('WorkFlowController :: Starting');

                    }

                    progressBarService.value = 50;
                    $state.go("elearning.module-two", {hasCode: self.hasCode, thisCode: self.thisCode, email: self.email});
                } else {
                    self.step += 1;
                }
            };

            progressBarService.value = self.progressValue;
        }]);

}(window.angular));

;(function(angular) {
    "use strict";

    angular
        .module('distractology')
        .controller('ModuleTwoController', ['$log', '$stateParams', '$state', '$http', '$sce', function($log, $stateParams, $state, $http, $sce) {
            var self = this;
            self.steps = ['one', 'two', 'three', 'four', 'five'];
            self.step = 0;
            self.subCounter = 0;

            self.hasCode = $stateParams.hasCode;
            self.thisCode = $stateParams.thisCode;
            self.email = $stateParams.email;

            self.showContinueButton = false;
            self.modal10Home = true;
            self.subStep10A = false;
            self.subStep10B = false;
            self.subStep10C = false;

            self.subStep10Alink = false;
            self.subStep10Blink = false;
            self.subStep10Clink = false;

            self.questions = true;
            self.wrongThis = false;
            self.rightThis = false;

            self.finished = function() {
                self.showContinueButton = true;
            };

            self.isFirstStep = function () {
                return self.step === 0;
            };

            self.isLastStep = function () {
                return self.step === (self.steps.length - 1);
            };

            self.isCurrentStep = function (step) {
                return self.step === step;
            };

            self.setCurrentStep = function (step) {
                self.step = step;
            };

            self.getCurrentStep = function () {
                return self.steps[self.step];
            };

            self.subStepA = function () {
                self.modal10Home = false;
                self.subStep10A = true;
                self.subStep10B = false;
                self.subStep10C = false;
            };
            self.subStepB = function () {
                self.modal10Home = false;
                self.subStep10A = false;
                self.subStep10B = true;
                self.subStep10C = false;
            };
            self.subStepC = function () {
                self.modal10Home = false;
                self.subStep10A = false;
                self.subStep10B = false;
                self.subStep10C = true;
            };
            self.decideRightWrongA = function() {
                self.questions = false;
                if (self.wizard.module2_question1_a.length < 7) {
                    self.wrongThis = true;
                } else {
                    self.rightThis = true;
                }
            };
            self.getNextLabel = function () {
                return (self.isLastStep()) ? 'Continue' : 'Continue';
            };

            self.handlePrevious = function () {
                self.step -= (self.isFirstStep()) ? 0 : 1;
            };

            self.handleNext = function () {
                if (self.isLastStep()) {
                    var moduleDetails = {studentCode: self.thisCode, module: 2 };
                    if(self.hasCode == true && self.thisCode != 'agent') {
                        $http
                            .post('/api/workflows/update', moduleDetails)
                            .success(postSuccess)
                            .error(postError);

                            $log.info('WorkFlowController-Update :: Starting');
                    }

                    $state.go("elearning.module-three", {hasCode: self.hasCode, thisCode: self.thisCode, email: self.email});
                } else {
                    self.step += 1;
                    if(self.step == 1) {
                        self.showContinueButton = false;
                    }
                    if (self.getCurrentStep() == 'two') {
                        self.config = {
                            sources: [
                                {src: $sce.trustAsResourceUrl("http://arbella.media.jackmorton.net/video/2016_Arbella_Module_2BCD_v2.mp4"), type: "video/mp4"},
                                {src: $sce.trustAsResourceUrl("http://arbella.media.jackmorton.net/video/2016_Arbella_Module_2BCD_v2.ogv"), type: "video/ogg"}
                            ],
                                responsive: true,
                            theme: {
                                url:"http://www.videogular.com/styles/themes/default/latest/videogular.css",
                                            playIcon: "&#xe000;",
                                            pauseIcon: "&#xe001;",
                                            volumeLevel3Icon: "&#xe002;",
                                            volumeLevel2Icon: "&#xe003;",
                                            volumeLevel1Icon: "&#xe004;",
                                            volumeLevel0Icon: "&#xe005;",
                                            muteIcon: "&#xe006;",
                                            enterFullScreenIcon: "&#xe007;",
                                            exitFullScreenIcon: "&#xe008;"
                            },
                            plugins: {
                                poster: "http://arbella.media.jackmorton.net/video/posters/2016_Arbella_Module_2_frame1.png",
                                controls: {
                                    autoHide: true,
                                    autoHideTime: 2000
                                }
                            }
                        };
                    }
                }
            };

            function postSuccess(data) {
                $log.info('UpdateController :: update :: Success');
                $log.log(data);

            }

            function postError(data) {
                $log.info('UpdateController :: update :: Error');
                //$log.error('Error: ' + JSON.stringify(data, null, 4));
                //self.loginError = true;
            }
            if(self.getCurrentStep() == 'one') {
                self.config = {
                    sources: [
                        {src: $sce.trustAsResourceUrl("http://arbella.media.jackmorton.net/video/2016_Arbella_Module_2_v2.mp4"), type: "video/mp4"},
                        {src: $sce.trustAsResourceUrl("http://arbella.media.jackmorton.net/video/2016_Arbella_Module_2_v2.ogv"), type: "video/ogg"}
                    ],
                        responsive: true,
                    theme: {
                        url:"http://www.videogular.com/styles/themes/default/latest/videogular.css",
                                    playIcon: "&#xe000;",
                                    pauseIcon: "&#xe001;",
                                    volumeLevel3Icon: "&#xe002;",
                                    volumeLevel2Icon: "&#xe003;",
                                    volumeLevel1Icon: "&#xe004;",
                                    volumeLevel0Icon: "&#xe005;",
                                    muteIcon: "&#xe006;",
                                    enterFullScreenIcon: "&#xe007;",
                                    exitFullScreenIcon: "&#xe008;"
                    },
                    plugins: {
                        poster: "http://arbella.media.jackmorton.net/video/posters/2016_Arbella_Module_2_frame1.png",
                        controls: {
                            autoHide: true,
                            autoHideTime: 2000
                        }
                    }
                };
            }



        }]);

}(window.angular));

;(function(angular) {
    "use strict";

    angular
        .module('distractology')
        .controller('ModuleThreeController', ['$log', '$stateParams', '$state', '$http', '$sce', function($log, $stateParams, $state, $http, $sce) {
            var self = this;
            self.steps = ['one'];
            self.step = 0;

            self.hasCode = $stateParams.hasCode;
            self.thisCode = $stateParams.thisCode;
            self.email = $stateParams.email;

            self.showContinueButton = false;

            self.finished = function() {
                self.showContinueButton = true;
            };

            self.config = {
				sources: [
                    {src: $sce.trustAsResourceUrl("http://arbella.media.jackmorton.net/video/2016_Arbella_Module_3.mp4"), type: "video/mp4"},
                    {src: $sce.trustAsResourceUrl("http://arbella.media.jackmorton.net/video/2016_Arbella_Module_3.ogv"), type: "video/ogg"}
				],
                    responsive: true,
				theme: {
                    url:"http://www.videogular.com/styles/themes/default/latest/videogular.css",
                                playIcon: "&#xe000;",
                                pauseIcon: "&#xe001;",
                                volumeLevel3Icon: "&#xe002;",
                                volumeLevel2Icon: "&#xe003;",
                                volumeLevel1Icon: "&#xe004;",
                                volumeLevel0Icon: "&#xe005;",
                                muteIcon: "&#xe006;",
                                enterFullScreenIcon: "&#xe007;",
                                exitFullScreenIcon: "&#xe008;"
                },
				plugins: {
					poster: "http://arbella.media.jackmorton.net/video/posters/2016_Arbella_Module_3_frame1.png",
                    controls: {
                        autoHide: true,
                        autoHideTime: 2000
                    }
				}
			};

            self.isFirstStep = function () {
                return self.step === 0;
            };

            self.isLastStep = function () {
                return self.step === (self.steps.length - 1);
            };

            self.isCurrentStep = function (step) {
                return self.step === step;
            };

            self.setCurrentStep = function (step) {
                self.step = step;
            };

            self.getCurrentStep = function () {
                return self.steps[self.step];
            };

            self.getNextLabel = function () {
                return (self.isLastStep()) ? 'Continue' : 'Continue';
            };

            self.handlePrevious = function () {
                self.step -= (self.isFirstStep()) ? 0 : 1;
            };

            self.handleNext = function () {
                if (self.isLastStep()) {
                    if(self.hasCode == true ) {
                        var moduleDetails = {studentCode: self.thisCode, module: 3 };
                        if (self.thisCode != 'agent') {
                        $http
                            .post('/api/workflows/update', moduleDetails)

                            $log.info('WorkFlowController-Update :: Starting');
                        }

                        $state.go("elearning.module-four", {hasCode: self.hasCode, thisCode: self.thisCode, email: self.email});
                    }
                    else {
                        $state.go("elearning.module-five", {hasCode: self.hasCode, thisCode: self.thisCode, email: self.email});
                    }
                } else {
                    self.step += 1;
                }
            };
        }]);

}(window.angular));

;(function(angular) {
    "use strict";

    angular
        .module('distractology')
        .controller('ModuleFourController', ['$log', '$stateParams', '$state', '$http', '$sce', function($log, $stateParams, $state, $http, $sce) {

            var self = this;
            self.steps = ['one', 'two'];
            self.step = 0;

            self.hasCode = $stateParams.hasCode;
            self.thisCode = $stateParams.thisCode;
            self.email = $stateParams.email;

            self.showContinueButton = false;

            self.finished = function() {
                self.showContinueButton = true;
            };

            self.config = {
				sources: [
                    {src: $sce.trustAsResourceUrl("http://arbella.media.jackmorton.net/video/2016_Arbella_Module_4.mp4"), type: "video/mp4"},
                    {src: $sce.trustAsResourceUrl("http://arbella.media.jackmorton.net/video/2016_Arbella_Module_4.ogv"), type: "video/ogg"}
				],
                    responsive: true,
				theme: {
                    url:"http://www.videogular.com/styles/themes/default/latest/videogular.css",
                                playIcon: "&#xe000;",
                                pauseIcon: "&#xe001;",
                                volumeLevel3Icon: "&#xe002;",
                                volumeLevel2Icon: "&#xe003;",
                                volumeLevel1Icon: "&#xe004;",
                                volumeLevel0Icon: "&#xe005;",
                                muteIcon: "&#xe006;",
                                enterFullScreenIcon: "&#xe007;",
                                exitFullScreenIcon: "&#xe008;"
                },
				plugins: {
					poster: "http://arbella.media.jackmorton.net/video/posters/2016_Arbella_Module_4_frame1.png",
                    controls: {
                        autoHide: true,
                        autoHideTime: 2000
                    }
				}
			};

            self.isFirstStep = function () {
                return self.step === 0;
            };

            self.isLastStep = function () {
                return self.step === (self.steps.length - 1);
            };

            self.isCurrentStep = function (step) {
                return self.step === step;
            };

            self.setCurrentStep = function (step) {
                self.step = step;
            };

            self.getCurrentStep = function () {
                return self.steps[self.step];
            };

            self.getNextLabel = function () {
                return (self.isLastStep()) ? 'Continue' : 'Continue';
            };

            self.handlePrevious = function () {
                self.step -= (self.isFirstStep()) ? 0 : 1;
            };

            self.handleNext = function () {
                if (self.isLastStep()) {
                    var moduleDetails = {studentCode: self.thisCode, module: 4 };
                    if(self.hasCode == true && self.thisCode != 'agent') {
                    $http
                        .post('/api/workflows/update', moduleDetails)

                        $log.info('WorkFlowController-Update :: Starting');
                    }
                    $state.go("elearning.module-five", {hasCode: self.hasCode, thisCode: self.thisCode, email: self.email});
                } else {
                    self.step += 1;
                    self.showContinueButton = false;
                }
            };


        }])

       .directive('draggable', [function () {
            return {
                restrict: 'A',
                link: function(scope, element, attrs) {
                    // TODO put link related things here.
                    //console.log("We've made it here"  + element);


                    var questionGroupIndex = 1; //for testing change this index to go directly to question group
                    var questionIndex = 1;//this gets reset every time the questionGroupIndex is changed
                    var activeModel;
                    var playInstructionAudio = true;
                    var dragDropManager = new uiDragDropManager();
					var lastPlayedAudio;

					//Drop Targets
					var ddItem1Targets = {
					  dropTargets : [ {x:720, y:67}, {x:360, y:158}, {x:510, y:47}],
					  posOrigin : [{y:37, x:95}],
					  messagePos:[{x:10,y:125}],
					  instructions:[{copy:"Drag the sign to the place on the screen where the hazard is hidden", audio:"set1_instruction"},
					  {copy:"Drag the sign to the place on the screen where you should be slowing down"},
					  {copy:"Drag the sign to the place on the screen where hazard will first become visible to you"}],
					  drgIncorrect: [
									{incorrect:[{copy:"<p style='margin-top:-4.33%;'>You should have placed the button here. Something could be in the road, stop sign may be obscured by vegetation</p>", audio:"set1_q0_wrong"},
										{copy:"You should have placed the button here. You should slow down as you enter any blind curve.", audio: "set1_q0_wrong"},
										{copy:"You should have placed the button here. You should continuously monitor the side of the road for hidden hazards or obstacles", audio:"set1_q0_wrong"}]},
									{
									    incorrect: [{ copy: "<p style='margin-top:4.33%;'>You should have placed the button here. You should slow down as you enter any blind curve.</p>", audio: "set1_q1_wrong" },
										{copy:"You should have placed the button here. You should slow down as you enter any blind curve.", audio: "set1_q1_wrong"},
										{ copy: "<p style='margin-top:-4.33%;'>You should have placed the button here. You should continuously monitor the side of the road for hidden hazards or obstacles</p>", audio: "set1_q1_wrong" }]
									},
									{
									    incorrect: [{ copy: "<p style='margin-top:-4.33%;'>You should have placed the button here. You should continuously monitor the side of the road for hidden hazards or obstacles</p>", audio: "set1_q2_wrong" },
										{copy:"You should have placed the button here. You should slow down as you enter any blind curve.", audio: "set1_q2_wrong"},
										{copy:"You should have placed the button here. You should continuously monitor the side of the road for hidden hazards or obstacles", audio:"set1_q2_wrong"}]}
									],
					  drgCorrect: [
								  {correct:[{copy:"<span>Great Job!</span>", audio:"set1_q0_correct"}]},
								  {correct:[{copy:"<span>Great Job!</span>", audio:"set1_q1_correct"}]},
								  {correct:[{copy:"<span>Great Job!</span>", audio:"set1_q2_correct"}]}
								  ],
					  audioCorrect: [],
					  audioIncorrect: []
					}

					var ddItem2Targets = {
					  dropTargets : [{x:645, y:143},  {x:775, y:234}, {x:775, y:141}],
					  posOrigin : [{y:262, x:255}],
					  messagePos:[{x:170,y:350}],
					  instructions:[{copy:"Drag the sign to the place on the screen where the hazard is hidden.", audio:"set2_instruction"},
					  {copy:"Drag the sign to the place on the screen where you should be slowing down.", audio:"set2_instruction"},
					  {copy:"Drag the sign to the place on the screen where the hazard will first become visible to you.", audio: "set2_instruction"}],
					  drgIncorrect: [
									{incorrect:[{copy:"<p style='margin-top:-15.84%;width:115%'>You should have placed the button here.  When there are cars in the left lane lined up in front of the crosswalk, you can't see whether someone is walking or even cycling across the road.</a>", audio:"set2_q0_wrong"},
									{copy:"You should have placed the button here. You should slow down as you enter any blind curve.", audio: "set2_q0_wrong"},
									{copy:"You should have placed the button here. You should continuously monitor the side of the road for hidden hazards or obstacles", audio:"set2_q0_wrong"}]},
									{incorrect:[{copy:"<p style='margin-top:-35%;width:115%' >Nope. You should have placed the button here. The crosswalk sign and the painted lines on the road tell you to approach cautiously. The line of cars obscuring your view makes it even more important to go slow.</p>", audio: "set2_q1_wrong"},
									{copy:"You should have placed the button here. You should slow down as you enter any blind curve.", audio: "set2_q1_wrong"},
									{copy:"You should have placed the button here. You should continuously monitor the side of the road for hidden hazards or obstacles", audio:"set2_q1_wrong"}]},
									{incorrect:[{copy:"<p style='margin-top:-35%;width:115%'>Nah uh. You should have placed the button here. As you approach the crosswalk, anyone coming from the street will appear here first. Don't cross those lines until you're sure it's clear.</p>", audio:"set2_q2_wrong"},
									{copy:"You should have placed the button here. You should slow down as you enter any blind curve.", audio: "set2_q2_wrong"},
									{copy:"You should have placed the button here. You should continuously monitor the side of the road for hidden hazards or obstacles", audio:"set2_q2_wrong"}]}
									],
					  drgCorrect: [
								  {correct:[{copy:"<p style='margin-top:-25%;'><span>Great Job!</span></p>", audio:"set2_q0_correct"}]},
								  {correct:[{copy:"<p style='margin-top:-25%;'><span>Great Job!</span></p>", audio:"set2_q1_correct"}]},
								  {correct:[{copy:"<p style='margin-top:-25%;'><span>Great Job!</span></p>", audio:"set2_q2_correct"}]}
								  ],
					  audioCorrect: [],
					  audioIncorrect: []
					}

					var ddItem3Targets = {

					  dropTargets : [{x:472, y:7}, {x:593, y:225}, {x:474, y:144}],
					  posOrigin : [{y:17, x:68}],
					  messagePos:[{x:160,y:25}],
					  instructions:[{copy:"Drag to the place on the screen where the hazard is hidden", audio:"set3_instruction"},
					  {copy:"Drag to the place on the screen where you should be slowing down", audio:"set3_instruction"},
					  {copy:"Drag to the place on the screen where hazard will first become visible to you", audio: "set3_instruction"}],
					  drgIncorrect: [
									{incorrect:[{copy:"<p style='margin-top:2.60%;width:90.54%;margin-left:-8.93%;'>You should have placed the button here. When there are cars in the oncoming left lane, you can't see whether there is traffic approaching the intersection in the far lane.</p>", audio:"set3_q0_wrong"},
										{copy:"You should have placed the button here. You should slow down as you enter any blind curve.", audio: "set3_q0_wrong"},
										{copy:"You should have placed the button here. You should continuously monitor the side of the road for hidden hazards or obstacles", audio:"set3_q0_wrong"}]},
									{incorrect:[{copy:"<p style='margin-top:12px;width:300px;margin-left:-85px;'>You should have placed the button here. In a situation like this, you're actually going to slow down and stop before making your left turn. Approach the turn slowly and proceed slowly, finishing your turn only after the coast is clear.</p>", audio: "set3_q1_wrong"},
										{copy:"You should have placed the button here. You should slow down as you enter any blind curve.", audio: "set3_q1_wrong"},
										{copy:"You should have placed the button here. You should continuously monitor the side of the road for hidden hazards or obstacles", audio:"set3_q1_wrong"}]},
									{incorrect:[{copy:"<p style='margin-top:12px;width:300px;margin-left:-85px;'>You should have placed the button here. The truck is obscuring your view into the left lane, so you have to keep looking around it as best you can to see if there is any oncoming traffic.</p>", audio:"set3_q2_wrong"},
										{copy:"You should have placed the button here. You should slow down as you enter any blind curve.", audio: "set3_q2_wrong"},
										{copy:"You should have placed the button here. You should continuously monitor the side of the road for hidden hazards or obstacles", audio:"set3_q2_wrong"}]}
									],
					  drgCorrect: [
								  { correct: [{ copy: "<p style='margin-left:-25%;'><span>Great Job!</span></p>", audio: "set3_q0_correct" }] },
								  { correct: [{ copy: "<p style='margin-left:-25%;'><span>Great Job!</span></p>", audio: "set3_q1_correct" }] },
								  { correct: [{ copy: "<p style='margin-left:-25%;'><span>Great Job!</span></p>", audio: "set3_q2_correct" }] }
								  ],
					  audioCorrect: [],
					  audioIncorrect: []
					}

                    /*------------- LOADING INTERACTIVE DRAG AND DROP -----------------------------------------*/

					function initDDui() {
					    element.draggable({
					        revert: function (socketObj) {
					            //if false then no socket object drop occurred.
					            if (socketObj === false) {
					                //revert the peg by returning true
					                //typically this would return true but because we want to display correct
					                //even if they got it wrong we will overwrite defaul behavior here
					                dragDropManager.handleReverts(this, socketObj);
					                return false;
					            }
					            else {
					                //socket object was returned,
					                //we can perform additional checks here if we like
					                var ddtargetRef = socketObj.attr('class').split(' ')[0];
					                dragDropManager.handleReverts(this, ddtargetRef);
					                //return false so that the peg does not revert
					                return false;
					            }
					        }
					    });

					    $('.ddtarget1').droppable({
					        accept: "#draggables",
					        drop: function (event, ui) {
					            var topOrigin = activeModel.dropTargets[questionIndex - 1].y;
					            var leftOrigin = activeModel.dropTargets[questionIndex - 1].x;
					            var dragged = $(ui.draggable).attr('id');
					            var _x = scaleXCoordinate(leftOrigin);
					            var _y = scaleYCoordinate(topOrigin);
					            $('#' + dragged).css({ left: _x + '%' });
					            $('#' + dragged).css({ top: _y + '%' });

					            var coordObj = DDtargetOffset(leftOrigin, topOrigin);
								
								//play audio for iphones
								
								//audioPlayBack(strAudioID)
								
								$('.disableClicks').show();
					        },
					        over: function (event, ui) {
					            $(this).find('div').addClass("active_hazzard");
					        },
					        out: function (event, ui) {
					            $(this).find('div').removeClass("active_hazzard");
					            var dragged = $(ui.draggable).attr('id');
					            var _x = scaleXCoordinate(activeModel.dropTargets[questionIndex - 1].x);
					            var _y = scaleYCoordinate(activeModel.dropTargets[questionIndex - 1].y);

					            $('#' + dragged).css({ left: _x + '%' });
					            $('#' + dragged).css({ top: _y + '%' });
					        }
					    });

					    $('.ddtarget2').droppable({
					        accept: "#draggables",
					        drop: function (event, ui) {
					            var topOrigin = activeModel.dropTargets[questionIndex - 1].y;
					            var leftOrigin = activeModel.dropTargets[questionIndex - 1].x;

					            var _x = scaleXCoordinate(leftOrigin);
					            var _y = scaleYCoordinate(topOrigin);

					            var dragged = $(ui.draggable).attr('id');

					            $('#' + dragged).css({ left: _x + '%' });
					            $('#' + dragged).css({ top: _y + '%' });
								
								$('.disableClicks').show();
					        },
					        over: function (event, ui) {
					            $(this).find('div').addClass("active_hazzard");
					        },
					        out: function (event, ui) {
					            $(this).find('div').removeClass("active_hazzard");
					            var dragged = $(ui.draggable).attr('id');

					            var _x = scaleXCoordinate(activeModel.dropTargets[questionIndex - 1].x);
					            var _y = scaleYCoordinate(activeModel.dropTargets[questionIndex - 1].y);

					            $('#' + dragged).css({ left: _x + '%' });
					            $('#' + dragged).css({ top: _y + '%' });
					        }
					    });

					    $('.ddtarget3').droppable({
					        accept: "#draggables",
					        drop: function (event, ui) {
					            var topOrigin = activeModel.dropTargets[questionIndex - 1].y;
					            var leftOrigin = activeModel.dropTargets[questionIndex - 1].x;

					            var _x = scaleXCoordinate(leftOrigin);
					            var _y = scaleYCoordinate(topOrigin);

					            var dragged = $(ui.draggable).attr('id');

					            $('#' + dragged).css({ left: _x + '%' });
					            $('#' + dragged).css({ top: _y + '%' });
								
								$('.disableClicks').show();

					        },
					        over: function (event, ui) {
					            $(this).find('div').addClass("active_hazzard");
					        },
					        out: function (event, ui) {
					            $(this).find('div').removeClass("active_hazzard");
					            var dragged = $(ui.draggable).attr('id');
					            var _x = scaleXCoordinate(activeModel.dropTargets[questionIndex - 1].x);
					            var _y = scaleYCoordinate(activeModel.dropTargets[questionIndex - 1].y);

					            $('#' + dragged).css({ left: _x + '%' });
					            $('#' + dragged).css({ top: _y + '%' });
					        }
					    });

					    $('.next_btn').click(function () { dragDropManager.getNextQuestion() });
					    $('.next_btn').hide();

					    dragDropManager.setupQuestions();
					}



                    //update Messages
					function updateMessage(ddInteractiveIndex, qIndex, isAnswerCorrect, wrongAnswerIndex, instrctIndex) {

					    //var instructionCopy  = activeModel.instructions[ddInteractiveIndex-1].copy;
					    var instructionCopy = (instrctIndex !== undefined && instrctIndex !== null) ? activeModel.instructions[instrctIndex - 1].copy : "";
					    var audio = activeModel.instructions[ddInteractiveIndex - 1].audio;
						
						console.log("instrctIndex: "+ instrctIndex + " instructionCopy : "+ instructionCopy + " audio: "+ audio + " qIndex: "+ qIndex + " playInstructionAudio: "+ playInstructionAudio)
					    $('.messages').html(instructionCopy);

					    if (qIndex > -1) {
					        var correctAnswer = activeModel.drgCorrect[qIndex].correct[0].copy;

					        if (wrongAnswerIndex != "undefined" && wrongAnswerIndex != null) {
					            var incorrectAnswer = activeModel.drgIncorrect[qIndex].incorrect[0].copy;
					            audio = activeModel.drgIncorrect[qIndex].incorrect[wrongAnswerIndex].audio;
					        }

					        if (isAnswerCorrect === true) {
					            $('.messages').html(correctAnswer);
					            console.log("AnswerCorrect: " + correctAnswer)
					            audio = activeModel.drgCorrect[qIndex].correct[0].audio;

					        } else {
					            $('.messages').html(incorrectAnswer);
					            console.log("wrongAnswerIndex: " + wrongAnswerIndex + ", qIndex: " + qIndex)
					            console.log(activeModel.drgIncorrect[qIndex].incorrect[wrongAnswerIndex].audio);
					        }

					        //Play our Audio
					        if (audio != null && audio != "undefined") audioPlayBack(audio);						
							
					        //consider adding timer her and/or wait for audio to finish playing before showing next button
					        

					    } else {

					        if (playInstructionAudio === true) {
					            //this will always be an instruction audio
					            if (audio != null && audio != "undefined") audioPlayBack(audio);
					        }

					        playInstructionAudio = false;
					    }
					}

                    //start the assumption we're at questionGroupIndex 1
					function uiDragDropManager() {

					    this.getNextQuestion = function () {
					        this.updateDroppables(questionIndex);
					        questionIndex++;
					        if (questionIndex > 3) {
					            questionGroupIndex++;
					            //console.log("questionGroupIndex: " + questionGroupIndex)
					            if (questionGroupIndex >= 4) {
					                $('.a-right').show();
					                this.disableDrags();
                                    var scope = angular.element($("#moduleFour")).scope();
                                        scope.$apply(function(){
                                        console.log('entering scope.apply()');
                                        scope.modal.showContinueButton = true;
                                    });

					                return;
					            }

					            questionIndex = 1;
					            activeModel = null;
					            this.buildInteractiveQuestions();
					        }
					        this.hideAllDraggables();
					        this.showCurrentDraggable(questionIndex);
					    };

					    this.setupQuestions = function () {
					        // if(questionGroupIndex == 1){
					        this.hideAllDraggables();
					        this.showCurrentDraggable(questionIndex);
					        //}
					    };

					    this.updateDroppables = function (index) {
					        $('.ddtarget' + index).droppable('disable');
					    }

					    this.hideAllQuestionGroups = function () { };

					    this.hideAllDraggables = function () {
					        $('#draggable1').hide();
					        $('#draggable2').hide();
					        $('#draggable3').hide();
					        this.clearStage();
					    };

					    this.showCurrentDraggable = function (index) {
					        $('#draggable' + index).show();
					        var _x = scaleXCoordinate(activeModel.posOrigin[0].x);
					        var _y = scaleYCoordinate(activeModel.posOrigin[0].y);

					        $('#draggables').css({ top: _y + '%' });
					        $('#draggables').css({ left: _x + '%' });

					        DDtargetOffset();
					        updateMessage(questionGroupIndex, -1, false, undefined, questionIndex);
					    };

					    this.clearStage = function () {
					        $('.next_btn').hide();

					        //re-enable all dd targets so can display highlights
					        $('.ddtarget1').droppable('enable');
					        $('.ddtarget2').droppable('enable');
					        $('.ddtarget3').droppable('enable');

					        $('.messages').html('');
					    };

					    this.disableDrags = function () {
					        $('.next_btn').hide();
					        $('.ddtarget1').droppable('disable');
					        $('.ddtarget2').droppable('disable');
					        $('.ddtarget3').droppable('disable');
							$( '#draggables' ).draggable({
							  disabled: true
							});
					    }


					    this.handleReverts = function (dragObj, dropTargetObj) {
					        var dragged = $(dragObj).attr('id');
					        var draggedItem = $(dragObj).children().eq(questionIndex - 1);

					        if (dropTargetObj === false) {
					            var _x = scaleXCoordinate(activeModel.dropTargets[questionIndex - 1].x);
					            var _y = scaleYCoordinate(activeModel.dropTargets[questionIndex - 1].y);

					            $('#' + dragged).css({ left: _x + '%' });
					            $('#' + dragged).css({ top: _y + '%' });

					            updateMessage(questionGroupIndex, 0, false, 0);

					        } else {
					            //console.log("else handleReverts:: dropTargetObj "+ dropTargetObj );
					            //evaluate drop target for correct answer
					            var correct = Number(draggedItem.attr('data-correct'));

					            //original buggy code
					            //var correctRef = Number($('.' + dropTargetObj).attr('data-ref'));
					            //Fixed
					            var _ddtarget = $('#ddItem' + questionGroupIndex).find('.' + dropTargetObj);
					            var correctRef = Number(_ddtarget.attr('data-ref'));//Number($('.' + dropTargetObj).attr('data-ref'));

					            if (correct == correctRef) {
					                updateMessage(questionGroupIndex, (questionIndex - 1), true);
					            } else {
					                var getNumIndex = Number(dropTargetObj.toString().substring(dropTargetObj.toString().length - 1));
					                //console.log("questionGroupIndex: " + questionGroupIndex + "  questionIndex: "+ (questionIndex-1)+ "    " + getNumIndex) ;
					                updateMessage(questionGroupIndex, (questionIndex - 1), false, (getNumIndex - 1));
					            }

					            //now hide the drop target
					            //TBD

					            $('.' + dropTargetObj).find('div').removeClass("active_hazzard");
					        }
					    };


					    this.buildInteractiveQuestions = function () {
					        //first we'll hide everything to ensure none displays by mistake
					        for (var i = 1; i <= 3; i++) {
					            var strItem = "ddItem" + i;
					            $("#" + strItem).hide();
					        }
					        //data to use
					        activeModel = eval('ddItem' + questionGroupIndex + 'Targets');

					        //now display the one we care about
					        $('#' + 'ddItem' + questionGroupIndex).show();
							playInstructionAudio = true;

					        var _x = scaleXCoordinate(activeModel.messagePos[0].x);
					        var _y = scaleYCoordinate(activeModel.messagePos[0].y);

					        $('#ddItem1-message').css({ top: _y + '%' });
					        $('#ddItem1-message').css({ left: _x + '%' });
					        if (questionGroupIndex <= 1) $(initDDui());
					    }
					}
                    //End of uiDragDropManager

                    //Audio PLayback
					function audioPlayBack(strAudioID) {
						if(lastPlayedAudio != null){
							lastPlayedAudio.pause();
							lastPlayedAudio.currentTime = 0;
						}
					
						var isInstruction = (strAudioID.substr(4).indexOf("instruction") >-1)? true : false;
						//console.log("audioID: "+ strAudioID + " isInstruction: " + isInstruction);
					    var mediaElement = document.getElementById(strAudioID);
						lastPlayedAudio = mediaElement;
					    //mediaElement.play();
					    $('.disableClicks').show();
						
						//remove any onclick event set by iphone sniffer
						$('#iphone-Audio').unbind('click');

					    mediaElement.addEventListener("ended", onAudioEnd);
						
						if((navigator.userAgent.match(/iPhone/i))) { // || (navigator.userAgent.match(/iPod/i))
							 //Code
							if(lastPlayedAudio != null){
								lastPlayedAudio.pause();
								lastPlayedAudio.currentTime = 0;
								lastPlayedAudio = null;
							}
							 
							$('#iphone-Audio').click(function(){							 
								var mediaElement = document.getElementById(strAudioID);
								lastPlayedAudio = mediaElement;
								mediaElement.play();
								//alert("Now playing "+ strAudioID + " media Element: "+ mediaElement);								
							});
							
							$('#iphone-Audio').click();
							 
							setTimeout(function(){
								mediaElement.removeEventListener("ended", onAudioEnd);
								$('.disableClicks').hide();
								if(!isInstruction)$('.next_btn').show();
							}, 2000);
							
							
						}
						
						mediaElement.play();
						
					    function onAudioEnd(e) {
							mediaElement = null;
					        e.target.removeEventListener("ended", onAudioEnd);
					        $('.disableClicks').hide();
							if(!isInstruction)$('.next_btn').show();
					    }
					}

					function scaleYCoordinate(target) {
					    //target/context
					    var contextHeight = 461;
					    return ((target / contextHeight) * 100);
					}

					function scaleXCoordinate(target) {
					    var contextWidth = 951;
					    return ((target / contextWidth) * 100);
					}

					function DDtargetOffset(targetx, targety) {
					    //get the tage width && height before calculation
					    var stage_w = $("#skyview1")[0].getBoundingClientRect().width;
					    var stage_h = $("#skyview1")[0].getBoundingClientRect().height;

					    var defpercent_w = scaleXCoordinate(targetx);
					    var defpercent_h = scaleXCoordinate(targety);
					    var coordx = defpercent_w / stage_w;
					    var coordy = defpercent_h / stage_h;

					    //console.log("coordx W: " + (coordx * 100) + " coordy H: " + (coordy * 100) + "  duece");
					    return { x: coordx, y: coordy };
					}


					dragDropManager.buildInteractiveQuestions();

                }
            }
        }]);

}(window.angular));

;(function(angular) {
    "use strict";

    angular
        .module('distractology')
        .controller('ModuleFiveController', ['$log', '$stateParams', '$state', '$http', '$sce', function($log, $stateParams, $state, $http, $sce) {
            var self = this;
            self.steps = ['one', 'two', 'three'];
            self.step = 0;

            self.hasCode = $stateParams.hasCode;
            self.thisCode = $stateParams.thisCode;
            self.email = $stateParams.email;

            self.questions = true;
            self.wrongThis = false;
            self.rightThis = false;

            self.showContinueButton = false;

            self.finished = function() {
                self.showContinueButton = true;
            };

            self.config = {
				sources: [
                    {src: $sce.trustAsResourceUrl("http://arbella.media.jackmorton.net/video/2016_Arbella_Module_5.mp4"), type: "video/mp4"},
                    {src: $sce.trustAsResourceUrl("http://arbella.media.jackmorton.net/video/2016_Arbella_Module_5.ogv"), type: "video/ogg"}
				],
                    responsive: true,
				theme: {
                    url:"http://www.videogular.com/styles/themes/default/latest/videogular.css",
                                playIcon: "&#xe000;",
                                pauseIcon: "&#xe001;",
                                volumeLevel3Icon: "&#xe002;",
                                volumeLevel2Icon: "&#xe003;",
                                volumeLevel1Icon: "&#xe004;",
                                volumeLevel0Icon: "&#xe005;",
                                muteIcon: "&#xe006;",
                                enterFullScreenIcon: "&#xe007;",
                                exitFullScreenIcon: "&#xe008;"
                },
				plugins: {
					poster: "http://arbella.media.jackmorton.net/video/posters/2016_Arbella_Module_5_frame1.png",
                    controls: {
                        autoHide: true,
                        autoHideTime: 2000
                    }
				}
			};

            self.isFirstStep = function () {
                return self.step === 0;
            };

            self.isLastStep = function () {
                return self.step === (self.steps.length - 1);
            };

            self.isCurrentStep = function (step) {
                return self.step === step;
            };

            self.setCurrentStep = function (step) {
                self.step = step;
            };
            self.decideRightWrongA = function() {
                self.questions = false;
                if (self.wizard.module2_question1_a.length < 2) {
                    self.wrongThis = true;
                } else {
                    self.rightThis = true;
                }
            };
            self.getCurrentStep = function () {
                return self.steps[self.step];
            };

            self.getNextLabel = function () {
                return (self.isLastStep()) ? 'Continue' : 'Continue';
            };

            self.handlePrevious = function () {
                self.step -= (self.isFirstStep()) ? 0 : 1;
            };

            self.handleNext = function () {
                if (self.isLastStep()) {
                    var moduleDetails = {studentCode: self.thisCode, module: 5 };
                    if(self.hasCode == true && self.thisCode != 'agent') {
                    $http
                        .post('/api/workflows/update', moduleDetails)

                        $log.info('WorkFlowController-Update :: Starting');
                    }
                    $state.go("elearning.module-summary", {hasCode: self.hasCode, thisCode: self.thisCode, email: self.email});
                } else {
                    self.step += 1;
                }
            };
        }]);

}(window.angular));

;(function(angular) {
    "use strict";

    angular
        .module('distractology')
        .controller('ModuleSummaryController', ['$log', '$stateParams', '$state', '$http', '$timeout', '$location', function($log, $stateParams, $state, $http, $timeout, $location) {
            var self = this;
            self.steps = ['one', 'two'];
            self.step = 0;

            var qstring = $location.search();

            self.hasCode = $stateParams.hasCode;
            self.thisCode = $stateParams.thisCode;
            self.email = $stateParams.email;

            if(typeof qstring.email != 'undefined' && typeof qstring.code != 'undefined') {
                self.hasCode = true;
                self.email = qstring.email;
                self.thisCode = qstring.code;
            }

            self.showContinueButton = false;

            self.isFirstStep = function () {
                return self.step === 0;
            };

            self.isLastStep = function () {
                return self.step === (self.steps.length - 1);
            };

            self.isCurrentStep = function (step) {
                return self.step === step;
            };

            self.setCurrentStep = function (step) {
                self.step = step;
            };

            self.getCurrentStep = function () {
                return self.steps[self.step];
            };

            self.getNextLabel = function () {
                return (self.isLastStep()) ? 'Continue' : 'Next';
            };

            self.handlePrevious = function () {
                self.step -= (self.isFirstStep()) ? 0 : 1;
            };

            self.handleNext = function () {
                if (self.isLastStep()) {

                } else {
                    self.step += 1;
                }
                var person = {email: self.email};

                if(self.hasCode == true && self.thisCode != 'agent') {
                    $http
                        .post('/api/students/getStudent', person)
                        .success(printNames);

                    $log.info('getPerson :: Starting');
                }
                else {
                    var ans= {message: {name: 'Agent'}};
                    printNames(ans);
                }
            };

            function printNames(data) {
                self.pName = data.message.name;
                self.date = new Date();
                $('.progress-striped').hide();
                $timeout(function() {
                  // Do something
                }, 2000).then(function() {
                    printDiv('certificate');
                })
            };

            function printDiv(divName) {
                 var printContents = document.getElementById(divName).innerHTML;
                 var originalContents = document.body.innerHTML;

                 document.body.innerHTML = printContents;

                 window.print();
                 var mediaQueryList = window.matchMedia('print');
                    mediaQueryList.addListener(function(mql) {
                        if (mql.matches) {
                            console.log('before print dialog open');
                        } else {
                            console.log('after print dialog closed');
                            location.reload();
                        }
                    });

                 document.body.innerHTML = originalContents;

                 //location.reload();
            };

            self.glink = $location.$$absUrl+'?email='+self.email+'&code='+self.thisCode;

            var emailData = { email: self.email, glink: self.glink, from: 'elearning' };

            if(self.hasCode == true && typeof qstring.email == 'undefined') {

                $log.info('linkEmail starting :: Starting');

                $http
                    .post('/api/email', emailData);
            }

        }]);

}(window.angular));

;(function(angular) {
  "use strict";

  angular
    .module('distractology')
    .controller('FactsController', ['$log', function($log) {
      var self = this;
      self.title = 'FACTS & STATS';
      self.subtitle = 'Distracted Driving Facts & Stats';
    }]);
}(window.angular));

;(function(angular) {
  "use strict";

  angular
    .module('distractology')
    .controller('LawsController', ['$log', function($log) {
      var self = this;
      self.title = 'LAWS';
      self.subtitle = 'Blah blah blah, text text text text text text text. Blah blah blah, text text text text text text text. ';
    }]);
}(window.angular));

;(function(angular) {
  "use strict";

  angular
    .module('distractology')
    .controller('PressController', ['$log', '$state', '$sce', '$http', function($log, $state, $sce, $http) {
      var self = this;
      self.title = 'PRESS & MEDIA';
      self.subtitle = 'MEDIA CONTACTS';
      self.subtitle2 = 'RESOURCES';
      $(window).scrollTop(0);

      $http
          .get('/api/press')
          .success(getSuccess)

      function getSuccess(data) {
          $log.log(data);
          self.copy = data[0].copy;
          self.copyId = data[0].copyId;
      };

  }]);

}(window.angular));

;(function(angular) {
  //"use strict";

  angular
    .module('distractology')
    .controller('PressAdminController', ['$log', '$state', '$stateParams', '$http', '$xtorage', '$timeout', function($log, $state, $stateParams, $http, $xtorage, $timeout) {
      var self = this;
      self.title = 'ADMINPRESS';
      self.submitted = false;

      self.loggedIn = $stateParams.isAuth;

      var getSuccess = function(data) {
          $log.log(data);
          self.copy = data[0].copy;
          self.copyId = data[0].copyId;
      };
      self.submit = function(details) {

           var text = {copy: details, copyId: self.copyId};
           $log.log(text);

          $http
              .post('/api/press/updateActive', text)
              .success(postSuccess)
              .error(postError);
              $log.info('TourController :: Bye!');
      }
      function postSuccess(data) {
          $log.info('PressController :: Success-Save');
          self.submitted = true;
          $log.log(data);
          $timeout(function() {
              self.submitted = false;
          }, 3000);
      }

      function postError(data) {}

      if(self.loggedIn == true) {
          $http
              .get('/api/press')
              .success(getSuccess);

       } else {
        $('nav').hide();
       }

  }]);
}(window.angular));

;(function(angular) {
  "use strict";

  angular
    .module('distractology')
    .controller('PressAssetsController', ['$log', function($log) {
      var self = this;
      self.title = 'PHOTOS & VIDEOS';
      self.subtitle = 'Blah blah blah, text text text text text text text. Blah blah blah, text text text text text text text. ';

      $log.info('PressAssetsController::Started');
      $('#carousel-example-generic').carousel('cycle');
    }]);
}(window.angular));

;(function(angular) {
  "use strict";

  angular
    .module('distractology')
    .controller('PressMediaController', ['$log', function($log) {
      var self = this;
      self.title = 'MEDIA COVERAGE';
      self.subtitle = 'Blah blah blah, text text text text text text text. Blah blah blah, text text text text text text text. ';
    }]);
}(window.angular));

;(function(angular) {
  "use strict";

  angular
    .module('distractology')
    .controller('FaqController', ['$log', function($log) {
      var self = this;
      self.title = 'FAQ';
    }]);
}(window.angular));

;(function(angular) {
  "use strict";

  angular
    .module('distractology')
    .controller('ContactController', ['$log', '$state', '$http', function($log, $state, $http) {
      var self = this;
      self.title = 'CONTACT';

      self.submitted = false;
      self.duplicate = false;
      self.active = false;

      self.contact = {};

      $(window).scrollTop(0);
      $log.info('ContactController - starting up, yeah!');
      //console.log($state);

      self.submit = function(details) {
        //$log.debug(details);
        //self.submitted = true;
        //$state.go("confirmation");
        $log.debug(details);
        self.contact = details;
        self.active = true

        $http
            .post('/api/contacts', details)
            .success(postSuccess, details)
            .error(postError);

        $log.info('ContactController :: Bye!');
      }


      function postSuccess(data, details) {
          $log.info('ContactController :: Success');

          self.submitted = true;
          //self.duplicate = false;

          $log.info('EmailController:: In!');
          self.contact['from'] = 'contact';

          $log.log(self.contact);
          $http
              .post('/api/email', self.contact);

          self.active = false;

      }

      function postError(data) {
          $log.info('ContactController :: Error');
          $log.info('Error: ' + JSON.stringify(data, null, 4));

          self.submitted = false;
          //self.duplicate = true;
          self.active = false;
          swal({
              title: "Error",
              text: "Contact Admin",
              type: "error",
              showCancelButton: false,
              closeOnConfirm: true
          });
      }

  }]);

}(window.angular));

;(function(angular) {
  "use strict";

  angular
    .module('distractology')
    .controller('ContactConfirmationController', ['$log', function($log) {
      var self = this;
      self.title = 'CONTACT CONFIRMATION';
    }]);
}(window.angular));

;(function(angular) {
  "use strict";

  angular
    .module('distractology')
    .controller('EducatorsController', ['$log', '$state', '$http', function($log, $state, $http) {
      var self = this;
      self.title = 'EDUCATORS';

      $log.info('EducatorsController - starting up, yeah!');

      self.submit = function(details) {

          $http
              .post('/api/educators', details)
              .success(postSuccess)
              .error(postError);

          $log.info('EducatorController :: Bye!');

            $log.debug(details);

      }

      function postSuccess(data) {
          $log.info('EducatorController :: Success');
          $log.log(data);

          self.submitted = true;
          self.duplicate = false;

          $state.go("landing");

      }

      function postError(data) {

          swal({
              title: "User Alredy Exits",
              text: "Choose diferent User",
              type: "warning",
              showCancelButton: false,
              closeOnConfirm: true
          });

          $log.info('EducatorController :: Error');
          $log.info('Error: ' + JSON.stringify(data, null, 4));

          self.submitted = false;
          self.duplicate = true;
      }

    }]);
}(window.angular));

;(function(angular) {
  "use strict";

  angular
    .module('distractology')
    .controller('EducatorsLandingController', ['$log', function($log) {
      var self = this;
      self.title = 'FOR EDUCATORS';
      $log.info('EducatorsLandingController - starting up, yeah!');
    }]);
}(window.angular));

;(function(angular) {
  "use strict";

  angular
    .module('distractology')
    .controller('SurveyController', ['$log', '$state', '$http', '$xtorage', function($log, $state, $http, $xtorage) {
      var self = this;
      self.title = 'SURVEY ALT';

      self.submitted = false;
      self.duplicate = false;

      self.offLineData = "";

      $log.info('SurveyController - starting up, yeah!');

      self.submit = function(details) {
           self.offLineData = details;
          if(navigator.onLine === true) {
              $log.info('SurveyController :: Submit!');
              $log.debug(details);

              $http
                  .post('/api/students', details)
                  .success(postSuccess)
                  .error(postError);

              $log.info('SurveyController :: Bye!');
          } else {
              $xtorage.save("survey"+details.surveyType+"-"+details.code, self.offLineData);
              $log.info('LocalStorage :: Success');
              swal({
                  title: "You are Offline!",
                  text: "Data is being saved locally!",
                  type: "warning",
                  showCancelButton: false,
                  closeOnConfirm: true
                },
                function(){
                    $log.info('Cleanning Fields :: Success');
                    $('#SurveyForm')[0].reset();
                });
          }
      }


      function postSuccess(data) {
          $log.info('SurveyController :: Success');

          self.submitted = true;
          self.duplicate = false;

          setTimeout(function(){
              $state.reload();
          }, 5000);
      }

      function postError(data) {
          $log.info('SurveyController :: Error');
          $log.error('Error: ' + JSON.stringify(data, null, 4));

          self.submitted = false;
          self.duplicate = true;
      }
    }]);
}(window.angular));

;(function(angular) {
  //"use strict";

  angular
    .module('distractology')
    .controller('AdminController', ['$log', '$state', '$stateParams', '$http', '$xtorage', function($log, $state, $stateParams, $http, $xtorage) {
      var self = this;
      self.title = 'ADMIN';

      self.loggedIn = $stateParams.isAuth;
      if(self.loggedIn == true) {

          $log.info('AdminController - starting up, yeah!');
          self.badEmail = '';
          self.errorReport = false;

          var i = 0,
          oJson = [],
          sKey;
          for (; sKey = window.localStorage.key(i); i++) {
              sKey = window.localStorage.key(i);
              if(sKey.includes('survey')) {
                  oJson.push(sKey);
             }
          }
           self.available = oJson.length;

          var stored = {};
          $.each(oJson, function(i,v){
              stored[v]= $xtorage.get(v);
              stored[v]['deleteOn']=false;
          });

          self.result = stored;

          self.pushData = function(stored) {
              $.each(self.result, function(i,v){
                  console.log(v);
                  $http
                      .post('/api/students', v)
                      .success(postSuccess)
                      .error(postError);

                  $log.info('SurveyController :: Bye!');
              });
          }
          function postSuccess(data) {
              $log.info('Saved Data:: ' + JSON.stringify(data, null, 4 ));
              $log.info('AdminController :: Success & Clearing Local Storage');
              $xtorage.remove("survey"+data[0].surveyType+"-"+data[0].code);
              //$state.reload();
              delete stored["survey"+data[0].surveyType+"-"+data[0].code];
              self.result = stored;
              self.errorReport = false;
          }

          function postError(data) {
              self.errorReport = true;
              $log.info('Admin Controller :: Error');
              $log.info('Error: ' + JSON.stringify(data, null, 4));
              self.badEmail = self.badEmail + JSON.stringify(data, null, 4) + " ";
              self.currBadEmail = JSON.stringify(data, null, 4).replace(/"/g, "");
              $.each(stored, function(i,v){
                  if(v.email == self.currBadEmail) {
                      stored[i].deleteOn = true;
                  }
              });
              self.result = stored;
              swal({
                  title: "Email Already Exists",
                  text: self.badEmail + ":: not transfered!",
                  type: "error",
                  showCancelButton: false,
                  closeOnConfirm: true
              });
          }

          self.delRow = function(data) {
              $xtorage.remove("survey"+data.surveyType+"-"+data.code);
              delete stored["survey"+data.surveyType+"-"+data.code];
              self.result = stored;
              self.available--;
          }

          //$log.info('Saved Data:: ' + JSON.stringify(stored, null, 4 ));
    } else {
        $('nav').hide();
    }

  }]);
}(window.angular));
